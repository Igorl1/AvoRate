<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    {% include 'tracker/header.html' %}
    <title>
      AvoRate -
      {% if item is defined %}Editar item{% else %}Adicionar item{% endif %}
    </title>
  </head>
  <body>
    {% include 'tracker/global_links.html' %}

    <main class="page-container">
      <section class="card">
        <a href="{{ url_for('tracker.home') }}" class="btn-ghost" style="margin-bottom: 1rem">
          ← Back to dashboard
        </a>

        <h1 class="page-title">
          {% if item is defined %}Edit item{% else %}Add item{% endif %}
        </h1>

        <form class="form" method="POST" action="">
          <div class="form-field">
            <label for="title">Title</label>
            <input
              id="title"
              name="title"
              type="text"
              required
              value="{{ item.title if item is defined else '' }}"
            />
          </div>

          <div class="form-row-inline">
            <div class="form-field">
              <label for="media_type">Type</label>
              {% set types = media_types %}
              <select id="media_type" name="media_type">
                {% set current_type = item.mediaType.value if item is defined and item.mediaType else '' %}
                {% for value, label in types %}
                <option
                  value="{{ value }}"
                  {% if value == current_type %}selected{% endif %}
                >
                  {{ label }}
                </option>
                {% endfor %}
              </select>
            </div>

            <div class="form-field">
              <label for="status">Status</label>
              {% set statuses = status_choices %}
              <select id="status" name="status">
                {% set current_status = item.status.value if item is defined and item.status else '' %}
                {% for value, label in statuses %}
                <option
                  value="{{ value }}"
                  {% if value == current_status %}selected{% endif %}
                >
                  {{ label }}
                </option>
                {% endfor %}
              </select>
            </div>
          </div>

          <div class="form-row-inline">
            <div class="form-field">
              <label for="rating">Rating</label>
              {% set ratings = rating_choices %}
              <select id="rating" name="rating">
                {% set current_rating = item.rating|string if item is defined and item.rating is not none else '' %}
                {% for value, label in ratings %}
                <option
                  value="{{ value }}"
                  {% if value == current_rating %}selected{% endif %}
                >
                  {{ label }}
                </option>
                {% endfor %}
              </select>
            </div>
          </div>

          <div class="form-field">
            <label for="review">Review / Description</label>
            <textarea
              id="review"
              name="description"
              placeholder="Optional: write what you thought or why you want to follow this media"
            >{{ item.description if item is defined else '' }}</textarea>
          </div>

          <div class="form-actions">
            <button type="submit" class="btn-primary">
              {% if item is defined %}Save Changes{% else %}Adicionar ao dashboard{% endif %}
            </button>

            <!-- backend: esse botão pode virar um link para deletar (ex: url_for('tracker.delete_media', id=item.id)) -->
            {% if item is defined %}
            <button
              type="button"
              class="btn-danger"
              onclick="alert('backend: ligar depois com rota de exclusão')"
            >
              Excluir
            </button>
            {% endif %}
          </div>
        </form>
      </section>
    </main>
  </body>
</html>
